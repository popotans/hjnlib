/**
 *  author:		nbsp - http://www.xujiantao.com
 *	version:	NbspAutoComplete1.0 - 2012-09-22
 */
(function(e){e.fn.NbspAutoComplete=function(t){function c(n){f="",n.each(function(n){if(this.value!=""){t.datatype=="xml"?u=e(this).text():"",t.datatype=="json"?u=this.value:"";if(t.selectcount=="all"||t.selectcount=="scrollbar"||t.selectcount!="all"&&n<t.selectcount)f+="<li>"+u+"</li>",s=n}}),a.find("ul").find(".clicks").text()!=r.val()&&a.find("ul").html(f),l=a.find("li").last().index()+1;if(t.selectcount=="scrollbar"){var i;l<t.scrollbarcount?i=l*parseInt(t.liheight):i=t.scrollbarcount*parseInt(t.liheight),a.css({height:i,overflow:"auto"})}}function h(){f==""?a.trigger("scolse"):(a.show().end().find("li").css({height:t.liheight,"line-height":t.liheight}),a.find("li").hover(function(){o!=1&&(i=e(this).index()+1,a.find("li").removeClass("clicks"),e(this).addClass("clicks"))},function(){o=0}))}function p(e){switch(e){case 40:o=1,i<s+1?i+=1:i=1;var n=a.find("li:eq("+parseInt(i-1)+")");a.find("li").removeClass("clicks"),n.addClass("clicks"),r.val(n.text()),t.selectcount=="scrollbar"&&(i>t.scrollbarcount?a.scrollTop(a.scrollTop()+parseInt(t.liheight)):a.scrollTop(0));break;case 38:i<=1?i=s+1:i-=1;var n=a.find("ul").find("li:eq("+parseInt(i-1)+")");a.find("li").removeClass("clicks"),n.addClass("clicks"),r.val(n.text()),t.selectcount=="scrollbar"&&(i<l&&l-i+1>t.scrollbarcount?a.scrollTop(a.scrollTop()-parseInt(t.liheight)):a.scrollTop(l*parseInt(t.liheight)));break;case 13:a.trigger("scolse").end().parentsUntil("form").submit()}}var n={location:"",liheight:"22px",selectcount:"all",scrollbarcount:4,datatype:"json"};e(this).attr("autocomplete","off"),e(this).parent().append("<div class='nbspauto'><ul></ul></div>"),e(this).parent().find(".nbspauto").css("width",e(this).outerWidth(!0)-2);var t=e.extend(n,t),r=e(this),i=0,s,o,u,a=e(this).parent().find(".nbspauto"),f,l;e(this).parent().find(".nbspauto").bind("scolse",function(){e(this).hide().find("ul").html("")}),r.keyup(function(n){var i=n.which,s;i==38||i==40||i==13?p(i):e.get(t.location,{input:r.val()},function(n){t.datatype=="xml"?s=e(n).find(r.val()).find("data"):"",t.datatype=="json"?s=e(n):"",c(s),h()},t.datatype)}),r.blur(function(){r.parent().find(".nbspauto li").click(function(){r.val(e(this).text())}),e(document).not(r).click(function(){r.parent().find(".nbspauto").trigger("scolse")})})}})(jQuery)